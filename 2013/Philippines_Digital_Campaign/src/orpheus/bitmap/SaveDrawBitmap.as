package orpheus.bitmap {	import flash.net.URLRequest;		import flash.display.BitmapData;		import flash.display.Bitmap;		import flash.events.Event;		import flash.display.Loader;		import flash.display.Sprite;	/**	 * @author philip	 */	public class SaveDrawBitmap extends Sprite 	{		private var loader:Loader;		private var request:URLRequest;		private var saveBitmap:SaveBitmap;		private var bitmapData:BitmapData;		private var savefileName:String;		private var serverURL:String;		private var _bitmapData:BitmapData;		public function SaveDrawBitmap(serverURL:String, imgURL:String, bitmapData:BitmapData = null, savefileName:String = "")		{			if (!serverURL || !imgURL) return;						this.serverURL = serverURL;			this.savefileName = savefileName;			this.bitmapData = bitmapData;						request = new URLRequest(imgURL);						loader = new Loader();			loader.contentLoaderInfo.addEventListener(Event.COMPLETE, loadCompleteHandler);			loader.load(request);						saveBitmap = new SaveBitmap();			saveBitmap.addEventListener(Event.COMPLETE, saveCompleteHandler);		}		private function loadCompleteHandler(event:Event):void		{			var bitmap:Bitmap = loader.content as Bitmap;			_bitmapData = bitmap.bitmapData;						if (bitmapData) _bitmapData.draw(bitmapData);						saveBitmap.save(_bitmapData, serverURL, savefileName);		}		private function saveCompleteHandler(event:Event):void		{			dispatchEvent(event);			var bitmap:Bitmap = new Bitmap();			bitmap.bitmapData = _bitmapData;			addChild(bitmap);		}	}}